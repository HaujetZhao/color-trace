[Gitee](https://gitee.com/haujet/color-trace)   [GitHub](https://github.com/HaujetZhao/color-trace) 

#  Color Trace

> æ›´æ–°æ—¥æœŸï¼š2021 å¹´ 8 æœˆ 6 æ—¥

è¿™æ˜¯ä¸€ä¸ªå°†ä½å›¾ææ‘¹ä¸ºå½©è‰²çŸ¢é‡ svg å›¾ç‰‡çš„ç¨‹åºï¼Œæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨ Python è„šæœ¬å®ç°ï¼Œè¿è¡Œç¯å¢ƒ Python3.8+ã€‚

## âœ¨ æ•ˆæœ

ä»¥ä¸€ä¸ªå­—å¸–å›¾ç‰‡ä¸ºä¾‹ï¼Œè¿™æ˜¯ png æ ¼å¼çš„ä½å›¾ï¼ˆ370KBï¼‰ï¼š

![ä½å›¾](assets/ä½å›¾.png)

è¿™æ˜¯é¢œè‰²æ•°ä¸º 1 çš„ svg è½¬æ¢ç»“æœï¼Œå³åªæœ‰é»‘è‰²ï¼ˆ32KBï¼‰ï¼š

![çŸ¢é‡å›¾-1é¢œè‰²](assets/çŸ¢é‡å›¾-1é¢œè‰².svg)

é¢œè‰²æ•°ä¸º 3 çš„ svg è½¬æ¢ç»“æœï¼ˆ190KBï¼‰ï¼š

![çŸ¢é‡å›¾-3é¢œè‰²](assets/çŸ¢é‡å›¾-3é¢œè‰².svg)

## ğŸ“ åŸç†

å®ƒçš„åŸç†æ˜¯ï¼š

- å…ˆå°†ä½å›¾å›¾ç‰‡çš„é¢œè‰²ç¼©å‡ï¼Œä»¥ png ä¸ºä¸­è½¬æ ¼å¼
- å°†å›¾ç‰‡æŒ‰é¢œè‰²åˆ†å±‚
- å°†æ¯ä¸€å±‚é¢œè‰²ä½¿ç”¨ Potrace ç”ŸæˆçŸ¢é‡ svg å›¾ç‰‡
- æœ€åå°†æ‰€æœ‰é¢œè‰²çš„ svg å›¾ç‰‡åˆæˆä¸ºä¸€å¼ å½©è‰²çš„ svg å›¾ç‰‡

## ğŸ”¨ ä¾èµ–

ä¸ºäº†å®ç°ä¸Šè¿°çš„åŠŸèƒ½ï¼Œä½ éœ€è¦å…ˆä¿è¯å®‰è£…æœ‰ï¼š

- [ImageMagick](https://imagemagick.org/)ï¼Œç”¨äºè½¬æ¢å›¾åƒæ ¼å¼

- [Potrace](http://potrace.sourceforge.net/)ï¼Œç”¨äºå°†ä½å›¾è½¬æ¢ä¸ºå•ä¸€é¢œè‰²çŸ¢é‡å›¾

- [pngquant](https://pngquant.org)ï¼Œç”¨äºç¼©å‡é¢œè‰²ï¼ˆMedian-Cut ç®—æ³•ï¼Œè¿™æ˜¯é»˜è®¤ä½¿ç”¨çš„ç®—æ³•ï¼‰

- [pngnq](http://pngnq.sourceforge.net/)ï¼Œç”¨äºç¼©å‡é¢œè‰²ï¼ˆNeuQuant ç®—æ³•ï¼‰

  > pngnq æ˜¯å¯é€‰å®‰è£…ï¼ŒNeuQuant ç®—æ³•å¯ä»¥ç”Ÿæˆæ›´å¤šé¢œè‰²ï¼Œå¦‚æœä½ ä¸å»æ‰‹åŠ¨é€‰æ‹©è¿™ä¸ªç®—æ³•ï¼Œå°±ä¸éœ€è¦å®‰è£… pngnq
  >
  > å› ä¸ºåœ¨ Windows ä¸Šå®‰è£… pngnq è¿˜éœ€è¦æ‰‹åŠ¨å»ä¸‹è½½ `libpng13.dll`ï¼Œå¤ªéº»çƒ¦ã€‚æ‡’äººå°±ç›´æ¥ä¸ç”¨å®ƒäº†ã€‚

> ä¸Šè¿°å®‰è£…çš„æ„æ€æ˜¯ï¼šå°†é‚£äº›ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ã€‚ï¼ˆå¦‚æœä¸æ‡‚è¿™å¥è¯çš„æ„æ€å¯ä»¥ç™¾åº¦å­¦ä¹ ä¸‹ï¼Œè¿™ä¸ªå¤ªåŸºç¡€ï¼Œå°±ä¸è®²äº†ï¼‰

Python ä¾èµ–ä¸‹åˆ—åº“ï¼š

* lxml

> ä½¿ç”¨ `pip` å®‰è£…å³å¯

## ğŸ‘ ä½¿ç”¨æ–¹å¼

æœ¬å·¥å…·æ˜¯ Python è„šæœ¬çš„å½¢å¼ï¼Œè„šæœ¬æ–‡ä»¶åœ¨ `src` æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼š

```
$ python color-trace.py -h
usage: color-trace.py [-h] -i src [src ...] [-o dest] [-d destdir] [-C N]
                      [--width <dim>] [--height <dim>] [-c N] [-q algorithm]
                      [-fs | -ri] [-r paletteimg] [-s] [-p size] [-D size]
                      [-S threshold] [-O tolerance] [-bg] [-v] [--version]

ä½¿ç”¨ potrace å°†ä½å›¾è½¬åŒ–ä¸ºå½©è‰² svg çŸ¢é‡å›¾

optional arguments:
  -h, --help, /?        æ˜¾ç¤ºå¸®åŠ©
  -i src [src ...], --input src [src ...]
                        è¾“å…¥æ–‡ä»¶ï¼Œæ”¯æŒ * å’Œ ? é€šé…ç¬¦
  -o dest, --output dest
                        è¾“å‡ºä¿å­˜è·¯å¾„ï¼Œæ”¯æŒ * é€šé…ç¬¦
  -d destdir, --directory destdir
                        è¾“å‡ºä¿å­˜çš„æ–‡ä»¶å¤¹
  -C N, --cores N       å¤šè¿›ç¨‹å¤„ç†çš„è¿›ç¨‹æ•° (é»˜è®¤ä½¿ç”¨å…¨éƒ¨æ ¸å¿ƒ)
  --width <dim>         è¾“å‡º svg å›¾åƒå®½åº¦ï¼Œä¾‹å¦‚ï¼š6.5inã€ 15cmã€100ptï¼Œé»˜è®¤å•ä½æ˜¯ inch
  --height <dim>        è¾“å‡º svg å›¾åƒé«˜åº¦ï¼Œä¾‹å¦‚ï¼š6.5inã€ 15cmã€100ptï¼Œé»˜è®¤å•ä½æ˜¯ inch
  -c N, --colors N      [è‹¥æœªä½¿ç”¨ -p å‚æ•°ï¼Œåˆ™å¿…é¡»æŒ‡å®šè¯¥å‚æ•°] è¡¨ç¤ºåœ¨ææ‘¹å‰ï¼Œå…ˆç¼©å‡åˆ°å¤šå°‘ä¸ªé¢œè‰²ã€‚æœ€å¤š 256
                        ä¸ªã€‚0è¡¨ç¤ºè·³è¿‡ç¼©å‡é¢œè‰² (é™¤éä½ çš„å›¾ç‰‡å·²ç»ç¼©å‡è¿‡é¢œè‰²ï¼Œå¦åˆ™ä¸æ¨è0)ã€‚
  -q algorithm, --quantization algorithm
                        é¢œè‰²é‡åŒ–ç®—æ³•ï¼Œå³ç¼©å‡é¢œè‰²ç®—æ³•: mc, as, or nq. 'mc' (Median-Cutï¼Œä¸­åˆ‡ï¼Œç”±
                        pngquant å®ç°ï¼Œäº§ç”Ÿè¾ƒå°‘çš„é¢œè‰²ï¼Œè¿™æ˜¯é»˜è®¤); 'as' (Adaptive Spatial
                        Subdivision è‡ªé€‚åº”ç©ºé—´ç»†åˆ†ï¼Œç”± ImageMagick å®ç°ï¼Œäº§ç”Ÿçš„é¢œè‰²æ›´å°‘); 'nq'
                        (NeuQuant ç¥ç»é‡åŒ–, å¯ä»¥ç”Ÿæˆæ›´å¤šçš„é¢œè‰²ï¼Œç”± pnqng å®ç°)ã€‚ å¦‚æœ --colors 0
                        åˆ™ä¸å¯ç”¨é‡åŒ–ã€‚
  -fs, --floydsteinberg
                        å¯ç”¨ Floyd-Steinberg æ‹Ÿè‰² (é€‚ç”¨äºæ‰€æœ‰é‡åŒ–ç®—æ³•æˆ– -p/--palette).è­¦å‘Š:
                        ä»»ä½•ç±³è‰²ç®—æ³•éƒ½ä¼šæ˜¾è‘—çš„å¢åŠ è¾“å‡º svg å›¾ç‰‡çš„å¤§å°å’Œå¤æ‚åº¦
  -ri, --riemersma      å¯ç”¨ Rimersa æ‹Ÿè‰² (åªé€‚ç”¨äº as é‡åŒ–ç®—æ³•æˆ– -p/--palette)
  -r paletteimg, --remap paletteimg
                        ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰è°ƒè‰²æ¿å›¾åƒï¼Œç”¨äºé¢œè‰²ç¼©å‡ [è¦†ç›– -c å’Œ -q é€‰é¡¹]
  -s, --stack           å †æ ˆææ‘¹ (è‹¥è¦æ›´ç²¾ç¡®çš„è¾“å‡ºï¼Œæ¨èç”¨è¿™ä¸ª)
  -p size, --prescale size
                        ä¸ºå¾—åˆ°æ›´å¤šçš„ç»†èŠ‚ï¼Œåœ¨ææ‘¹å‰ï¼Œå…ˆå°†å›¾ç‰‡è¿›è¡Œç¼©æ”¾ (é»˜è®¤å€¼: 1)ã€‚ä¾‹å¦‚ä½¿ç”¨ 2ï¼Œææ‘¹å‰å…ˆé¢„æ”¾å¤§ä¸¤å€
  -D size, --despeckle size
                        æŠ‘åˆ¶æ–‘ç‚¹çš„å¤§å°ï¼ˆå•ä½æ˜¯åƒç´ ï¼‰ (é»˜è®¤å€¼ï¼š2)
  -S threshold, --smoothcorners threshold
                        è½¬è§’å¹³æ»‘å‚æ•°ï¼š0 è¡¨ç¤ºä¸ä½œå¹³æ»‘å¤„ç†ï¼Œ1.334 æ˜¯æœ€å¤§ã€‚ï¼ˆé»˜è®¤å€¼ï¼š1.0
  -O tolerance, --optimizepaths tolerance
                        è´å¡å°”æ›²çº¿ä¼˜åŒ–å‚æ•°: æœ€å°æ˜¯0ï¼Œæœ€å¤§æ˜¯5(é»˜è®¤å€¼ï¼š0.2)
  -bg, --background     å°†ç¬¬ä¸€ä¸ªé¢œè‰²è¿™èƒŒæ™¯è‰²ï¼Œå¹¶å°½å¯èƒ½ä¼˜åŒ–æœ€ç»ˆçš„ svg
  -v, --verbose         æ‰“å°å‡ºè¿è¡Œæ—¶çš„ç»†èŠ‚
  --version             æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬
```

ä¾‹å¦‚ï¼š

```
$ python color-trace.py -i ä½å›¾.png -c 3 -o çŸ¢é‡.svg
$ python color-trace.py -i æ–‡ä»¶å¤¹/*.png -c 3 -d è¾“å‡ºæ–‡ä»¶å¤¹
```

## ğŸ”® èƒŒæ™¯

è¿™ä¸ªç¨‹åºçš„åˆå§‹ä»£ç 

æˆ‘å¸Œæœ›å°†æ‰‹ä¸Šçš„ä¸€äº›æ‰«æç‰ˆçš„ PDF ä¹¦ç±è½¬ä¸ºçŸ¢é‡æ ¼å¼ä¿å­˜ï¼Œå€ŸåŠ©çŸ¢é‡å›¾å½¢çš„ä¼˜ç‚¹ï¼Œå¦‚æœä½¿ç”¨é€‚å½“çš„å‚æ•°ï¼Œå¯ä»¥å¾—åˆ°æ›´è§‚çœ‹ä½“éªŒæ›´å¥½ã€ä½“ç§¯æ›´å°çš„ç”µå­ä¹¦ã€‚äºæ˜¯å‘ç°äº† [Potrace](http://potrace.sourceforge.net/)ï¼Œè½¬æ¢çš„æ•ˆæœéå¸¸å¥½ï¼Œè®¸å¤šç¨‹åºã€é¡¹ç›®éƒ½åœ¨ä½¿ç”¨å®ƒå’Œå®ƒçš„ä»£ç ï¼Œå”¯ä¸€çš„é—æ†¾æ˜¯å®ƒåªæ”¯æŒé»‘ç™½ã€‚

> Potrace(TM) æ˜¯ä¸€ç§ç”¨äºææ‘¹ä½å›¾çš„å·¥å…·ï¼Œå³å°†ä½å›¾è½¬æ¢ä¸ºå¹³æ»‘ã€å¯ç¼©æ”¾çš„å›¾åƒã€‚è¾“å…¥æ˜¯ä½å›¾ï¼ˆPBMã€PGMã€PPM æˆ– BMP æ ¼å¼ï¼‰ï¼Œè¾“å‡ºæ˜¯å‡ ç§çŸ¢é‡æ–‡ä»¶æ ¼å¼ä¹‹ä¸€ã€‚
>
> å…¸å‹ç”¨é€”æ˜¯ä»æ‰«æçš„æ•°æ®ï¼ˆä¾‹å¦‚å…¬å¸æˆ–å¤§å­¦å¾½æ ‡ã€æ‰‹å†™ç¬”è®°ç­‰ï¼‰åˆ›å»º SVG æˆ– PDF æ–‡ä»¶ã€‚ç”Ÿæˆçš„å›¾åƒæ˜¯å¹³æ»‘çš„ï¼Œå¯ä»¥ä»¥ä»»ä½•åˆ†è¾¨ç‡å‘ˆç°ã€‚
>
> Potrace ç›®å‰å¯ä»¥ç”Ÿæˆä»¥ä¸‹è¾“å‡ºæ ¼å¼ï¼šSVGã€PDFã€EPSã€PostScriptã€DXFã€GeoJSONã€PGMã€Gimppath å’Œ XFigã€‚

ç„¶åæˆ‘ä¹Ÿè¯•ç”¨äº† Adobe illustratorã€Inkscape çš„ææ‘¹åŠŸèƒ½ï¼Œä½†éƒ½éœ€è¦å›¾å½¢ç•Œé¢ä¸€å¼ ä¸€å¼ æ“ä½œï¼Œä¸èƒ½æ‰¹é‡åŒ–æ“ä½œï¼Œä¸å¦‚ [Potrace](http://potrace.sourceforge.net/)ã€‚

æ¯•ç«Ÿå‘ç°äº† [Potrace](http://potrace.sourceforge.net/) è¿™æ ·ä¸€ä¸ªå¤è€ã€ä¼˜ç§€ã€åº”ç”¨å¹¿æ³›çš„è½¯ä»¶ï¼Œç„¶åæˆ‘å°±åœ¨ [Github](https://github.com/) ä¸Šæœç´¢ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰äººç”¨ Python å’Œ Potrace ç»“åˆï¼Œåšå‡ºæœ‰æ„æ€çš„ä¸œè¥¿ã€‚

ç»“æœï¼Œè¿˜çœŸå°±æ‰¾åˆ°è¿™æ ·ä¸€ä¸ª star å‡ åçš„ repoï¼šç”± [customink](https://github.com/customink) åœ¨ 2012 å¹´ç”¨ Python3.2 å®ç°çš„ [color_trace](https://github.com/customink/color_trace) ï¼

çœ‹äº† readme åï¼Œæ€€ç€æ¿€åŠ¨çš„å¿ƒä¸‹è½½äº†æºç ï¼Œè¯•è¿è¡Œï¼Œç»“æœæŠ¥é”™ã€‚æ¯•ç«Ÿæ˜¯ 2012 å¹´ç”¨ Python3.2 å†™çš„ï¼Œå¤ªå¤è€äº†ï¼ŒPython çš„è®¸å¤šå†…ç½®å‡½æ•°éƒ½å˜äº†ä¸å°‘ã€‚

æƒ³è¦ç”¨çš„è¯ï¼Œå°±åªèƒ½è‡ªå·±ä¿®äº†ã€‚è‹±æ–‡æºç æˆ‘æ˜¯çœ‹ä¸ä¸‹å»ï¼Œå°±æŠŠé‡Œé¢çš„å¤§éƒ¨åˆ†æ³¨é‡Šå’Œå˜é‡éƒ½æ›¿æ¢æˆäº†æ–¹ä¾¿æˆ‘ç†è§£çš„ä¸­æ–‡ç¿»è¯‘ï¼Œè¿™æ ·æ‰é€æ¸ç†è§£äº†è¿™ä¸ªç¨‹åºçš„åŸç†ï¼Œç„¶åè¿›è¡Œæµ‹è¯•ã€ä¿®å¤ã€ä¼˜åŒ–ï¼Œæœ€ç»ˆå¯ç”¨äº†ã€‚Happyï¼



## â¤ è´¡çŒ®ä»£ç 

ç”±äºåšè¿™ä¸ªç¨‹åºçš„ç¬¬ä¸€ç›®çš„æ˜¯ç»™æˆ‘è‡ªå·±ç”¨ï¼Œæ‰€ä»¥å°±æ²¡æœ‰è€ƒè™‘å›½é™…åŒ–ï¼Œé‡Œé¢çš„å˜é‡åå¤§å¤šéƒ½æ˜¯ä¸­æ–‡ï¼Œç”šè‡³æŠŠå‘½ä»¤è¡Œå¸®åŠ©ä¹Ÿåšæˆäº†ä¸­æ–‡ã€‚è€ƒè™‘åˆ°æ–¹ä¾¿é˜…è¯»ã€ç»´æŠ¤ï¼Œè´¡çŒ®ä»£ç æ—¶è¯·ä½¿ç”¨ä¸­æ–‡ä½œä¸ºå˜é‡ã€æ³¨é‡Šçš„é¦–é€‰è¯­è¨€ã€‚

åœ¨å†™æ³¨é‡Šæ—¶ï¼Œä¸­æ–‡æ‰“å­—æ…¢ï¼Œè®¸å¤šéƒ¨åˆ†æˆ‘éƒ½æ˜¯ä½¿ç”¨ [HaujetZhao/CapsWriter](https://github.com/HaujetZhao/CapsWriter) è¿›è¡Œè¯­éŸ³è¾“å…¥è¾…åŠ©å®Œæˆçš„ï¼Œæ¨èä½¿ç”¨ã€‚

æœ‰èƒ½åŠ›çš„çˆ±å¥½è€…å¯ä»¥ fork æ­¤ repoï¼Œç¿»è¯‘ä¸ºè‹±æ–‡ä»£ç ã€‚

## â˜• æ‰“èµ

ä¸‡æ°´åƒå±±æ€»æ˜¯æƒ…ï¼Œä¸€å—å‡ å—éƒ½æ˜¯æƒ…ã€‚æœ¬è½¯ä»¶å®Œå…¨å¼€æºï¼Œç”¨çˆ±å‘ç”µï¼Œå¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥ä»¥æ‰“èµçš„æ–¹å¼æ”¯æŒæˆ‘ä¸€ä¸‹ï¼š

![sponsor](assets/sponsor.svg)

> è¿™ä¸ªæ‰“èµäºŒç»´ç å›¾ç‰‡ä¹Ÿæ˜¯ç”± jpg è½¬æˆäº†é»‘è‰²çš„ svg æ–‡ä»¶ï¼Œåªæœ‰ 55KBï¼ŒNiceï¼



## ğŸ˜€ äº¤æµ

å¦‚æœæœ‰è½¯ä»¶æ–¹é¢çš„åé¦ˆå¯ä»¥æäº¤ issuesï¼Œæˆ–è€…åŠ å…¥ QQ ç¾¤ï¼š[1146626791](https://qm.qq.com/cgi-bin/qm/qr?k=DgiFh5cclAElnELH4mOxqWUBxReyEVpm&jump_from=webapi) 



## ğŸ™ é¸£è°¢

